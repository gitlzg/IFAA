y1=y
dim(y1)
x1_a=x1
x2_a=x2
beta1=rep(NA,repN)
for(i in 1:repN){
a=(i-1)*sampleSize+1
b=i*sampleSize
# cat("i:",i,"\n")
# cat("a:",a,"\n")
# cat("b:",b,"\n")
y=y1[,a:b]
#print(y[,1:10])
Y12=y[1,]+y[2,]
logY12=log(Y12[Y12>0 & y[3,]>0])
Y3=y[3,(Y12>0 & y[3,]>0)]
logY3=log(Y3)
logY3_12=logY3-logY12
x1=x1_a[a:b]
x1_12=x1[Y12>0 & y[3,]>0]
x2=x2_a[a:b]
x2_12=x2[Y12>0 & y[3,]>0]
# resu.i=summary(lm(logY12~x1_12+x2_12))
resu.i=summary(lm(logY3_12~x1_12+x2_12))
beta1[i]=resu.i$coefficients[2,1]
}
bias=mean(beta1-betaEffect)
cat("estimate:",beta1,"\n")
cbind(TruValue=betaEffect,bias=bias,biasPcen=(100*bias/betaEffect))
repN=200
sampleSize=5000
n=repN*sampleSize
c=runif(n,1/80,1/20)
zeroThresh=100
betaEffect=1
betaMat=matrix(c(4,4,4,
0,0,betaEffect,
4,4,4),ncol=3)
x1=abs(rnorm(n))
x2=abs(rnorm(n))
bin=matrix(rbinom(n=(3*n),size=1,prob=0.9),nrow=3)
bin[,1:6]
y=exp(betaMat%*%t(cbind(rep(1,n),x1,x2))+
t(mvrnorm(n=n,mu=c(0,0,0),Sigma=diag(3))))
# y=y*bin
y=floor(y*bin*matrix(rep(c,each=3),nrow=3))
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
zeroMecha=apply(y,c(1,2),function(x)x>zeroThresh)
y=y*zeroMecha
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
repN=200
sampleSize=5000
n=repN*sampleSize
c=runif(n,1/80,1/20)
zeroThresh=120
betaEffect=1
betaMat=matrix(c(4,4,4,
0,0,betaEffect,
4,4,4),ncol=3)
x1=abs(rnorm(n))
x2=abs(rnorm(n))
bin=matrix(rbinom(n=(3*n),size=1,prob=0.9),nrow=3)
bin[,1:6]
y=exp(betaMat%*%t(cbind(rep(1,n),x1,x2))+
t(mvrnorm(n=n,mu=c(0,0,0),Sigma=diag(3))))
# y=y*bin
y=floor(y*bin*matrix(rep(c,each=3),nrow=3))
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
zeroMecha=apply(y,c(1,2),function(x)x>zeroThresh)
y=y*zeroMecha
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
repN=200
sampleSize=5000
n=repN*sampleSize
c=runif(n,1/80,1/20)
zeroThresh=220
betaEffect=1
betaMat=matrix(c(4,4,4,
0,0,betaEffect,
4,4,4),ncol=3)
x1=abs(rnorm(n))
x2=abs(rnorm(n))
bin=matrix(rbinom(n=(3*n),size=1,prob=0.9),nrow=3)
bin[,1:6]
y=exp(betaMat%*%t(cbind(rep(1,n),x1,x2))+
t(mvrnorm(n=n,mu=c(0,0,0),Sigma=diag(3))))
# y=y*bin
y=floor(y*bin*matrix(rep(c,each=3),nrow=3))
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
zeroMecha=apply(y,c(1,2),function(x)x>zeroThresh)
y=y*zeroMecha
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
y[,1:6]
dim(y)
y1=y
dim(y1)
x1_a=x1
x2_a=x2
beta1=rep(NA,repN)
for(i in 1:repN){
a=(i-1)*sampleSize+1
b=i*sampleSize
# cat("i:",i,"\n")
# cat("a:",a,"\n")
# cat("b:",b,"\n")
y=y1[,a:b]
#print(y[,1:10])
Y12=y[1,]+y[2,]
logY12=log(Y12[Y12>0 & y[3,]>0])
Y3=y[3,(Y12>0 & y[3,]>0)]
logY3=log(Y3)
logY3_12=logY3-logY12
x1=x1_a[a:b]
x1_12=x1[Y12>0 & y[3,]>0]
x2=x2_a[a:b]
x2_12=x2[Y12>0 & y[3,]>0]
# resu.i=summary(lm(logY12~x1_12+x2_12))
resu.i=summary(lm(logY3_12~x1_12+x2_12))
beta1[i]=resu.i$coefficients[2,1]
}
bias=mean(beta1-betaEffect)
cat("estimate:",beta1,"\n")
cbind(TruValue=betaEffect,bias=bias,biasPcen=(100*bias/betaEffect))
repN=200
sampleSize=5000
n=repN*sampleSize
c=runif(n,1/80,1/20)
zeroThresh=20
betaEffect=1
betaMat=matrix(c(2,2,2,
0,0,betaEffect,
2,2,2),ncol=3)
x1=abs(rnorm(n))
x2=abs(rnorm(n))
bin=matrix(rbinom(n=(3*n),size=1,prob=0.9),nrow=3)
bin[,1:6]
y=exp(betaMat%*%t(cbind(rep(1,n),x1,x2))+
t(mvrnorm(n=n,mu=c(0,0,0),Sigma=diag(3))))
# y=y*bin
y=floor(y*bin*matrix(rep(c,each=3),nrow=3))
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
y[,1:6]
dim(y)
y1=y
dim(y1)
x1_a=x1
x2_a=x2
beta1=rep(NA,repN)
for(i in 1:repN){
a=(i-1)*sampleSize+1
b=i*sampleSize
# cat("i:",i,"\n")
# cat("a:",a,"\n")
# cat("b:",b,"\n")
y=y1[,a:b]
#print(y[,1:10])
Y12=y[1,]+y[2,]
logY12=log(Y12[Y12>0 & y[3,]>0])
Y3=y[3,(Y12>0 & y[3,]>0)]
logY3=log(Y3)
logY3_12=logY3-logY12
x1=x1_a[a:b]
x1_12=x1[Y12>0 & y[3,]>0]
x2=x2_a[a:b]
x2_12=x2[Y12>0 & y[3,]>0]
# resu.i=summary(lm(logY12~x1_12+x2_12))
resu.i=summary(lm(logY3_12~x1_12+x2_12))
beta1[i]=resu.i$coefficients[2,1]
}
bias=mean(beta1-betaEffect)
cat("estimate:",beta1,"\n")
cbind(TruValue=betaEffect,bias=bias,biasPcen=(100*bias/betaEffect))
#
## check additive property of lognormal distribution
#
library(rockchalk) # for mvrnorm()
repN=200
sampleSize=5000
n=repN*sampleSize
c=runif(n,1/80,1/20)
zeroThresh=20
betaEffect=1
betaMat=matrix(c(2,2,2,
0,0,betaEffect,
2,2,2),ncol=3)
x1=abs(rnorm(n))
x2=abs(rnorm(n))
bin=matrix(rbinom(n=(3*n),size=1,prob=0.9),nrow=3)
bin[,1:6]
y=exp(betaMat%*%t(cbind(rep(1,n),x1,x2))+
t(mvrnorm(n=n,mu=c(0,0,0),Sigma=diag(3))))
# y=y*bin
y=floor(y*bin*matrix(rep(c,each=3),nrow=3))
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
# zeroMecha=apply(y,c(1,2),function(x)x>zeroThresh)
# y=y*zeroMecha
# rowMeans(y==0)
# sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
y[,1:6]
dim(y)
y1=y
dim(y1)
x1_a=x1
x2_a=x2
beta1=rep(NA,repN)
for(i in 1:repN){
a=(i-1)*sampleSize+1
b=i*sampleSize
# cat("i:",i,"\n")
# cat("a:",a,"\n")
# cat("b:",b,"\n")
y=y1[,a:b]
#print(y[,1:10])
Y12=y[1,]+y[2,]
logY12=log(Y12[Y12>0 & y[3,]>0])
Y3=y[3,(Y12>0 & y[3,]>0)]
logY3=log(Y3)
logY3_12=logY3-logY12
x1=x1_a[a:b]
x1_12=x1[Y12>0 & y[3,]>0]
x2=x2_a[a:b]
x2_12=x2[Y12>0 & y[3,]>0]
# resu.i=summary(lm(logY12~x1_12+x2_12))
resu.i=summary(lm(logY3_12~x1_12+x2_12))
beta1[i]=resu.i$coefficients[2,1]
}
bias=mean(beta1-betaEffect)
cat("estimate:",beta1,"\n")
cbind(TruValue=betaEffect,bias=bias,biasPcen=(100*bias/betaEffect))
y[,1:6]
y[,1:60]
repN=200
sampleSize=5000
n=repN*sampleSize
c=runif(n,1/80,1/20)
zeroThresh=20
betaEffect=1
betaMat=matrix(c(2.2,2.2,2.2,
0,0,betaEffect,
2.2,2.2,2.2),ncol=3)
x1=abs(rnorm(n))
x2=abs(rnorm(n))
bin=matrix(rbinom(n=(3*n),size=1,prob=0.9),nrow=3)
bin[,1:6]
y=exp(betaMat%*%t(cbind(rep(1,n),x1,x2))+
t(mvrnorm(n=n,mu=c(0,0,0),Sigma=diag(3))))
# y=y*bin
y=floor(y*bin*matrix(rep(c,each=3),nrow=3))
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
repN=200
sampleSize=5000
n=repN*sampleSize
c=runif(n,1/80,1/20)
zeroThresh=20
betaEffect=1
betaMat=matrix(c(2,2,2,
0,0,betaEffect,
2,2,2),ncol=3)
x1=abs(rnorm(n))
x2=abs(rnorm(n))
bin=matrix(rbinom(n=(3*n),size=1,prob=0.9),nrow=3)
bin[,1:6]
y=exp(betaMat%*%t(cbind(rep(1,n),x1,x2))+
t(mvrnorm(n=n,mu=c(0,0,0),Sigma=diag(3))))
# y=y*bin
y=floor(y*bin*matrix(rep(c,each=3),nrow=3))
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
betaMat=matrix(c(2.5,2.5,2.5,
0,0,betaEffect,
2.5,2.5,2.5),ncol=3)
x1=abs(rnorm(n))
x2=abs(rnorm(n))
bin=matrix(rbinom(n=(3*n),size=1,prob=0.9),nrow=3)
bin[,1:6]
y=exp(betaMat%*%t(cbind(rep(1,n),x1,x2))+
t(mvrnorm(n=n,mu=c(0,0,0),Sigma=diag(3))))
# y=y*bin
y=floor(y*bin*matrix(rep(c,each=3),nrow=3))
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
zeroMecha=apply(y,c(1,2),function(x)x>zeroThresh)
y=y*zeroMecha
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
repN=200
sampleSize=5000
n=repN*sampleSize
c=runif(n,1/80,1/20)
zeroThresh=5
betaEffect=1
betaMat=matrix(c(2.5,2.5,2.5,
0,0,betaEffect,
2.5,2.5,2.5),ncol=3)
x1=abs(rnorm(n))
x2=abs(rnorm(n))
bin=matrix(rbinom(n=(3*n),size=1,prob=0.9),nrow=3)
bin[,1:6]
y=exp(betaMat%*%t(cbind(rep(1,n),x1,x2))+
t(mvrnorm(n=n,mu=c(0,0,0),Sigma=diag(3))))
# y=y*bin
y=floor(y*bin*matrix(rep(c,each=3),nrow=3))
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
zeroMecha=apply(y,c(1,2),function(x)x>zeroThresh)
y=y*zeroMecha
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
repN=200
sampleSize=5000
n=repN*sampleSize
c=runif(n,1/80,1/20)
zeroThresh=4
betaEffect=1
betaMat=matrix(c(2.5,2.5,2.5,
0,0,betaEffect,
2.5,2.5,2.5),ncol=3)
x1=abs(rnorm(n))
x2=abs(rnorm(n))
bin=matrix(rbinom(n=(3*n),size=1,prob=0.9),nrow=3)
bin[,1:6]
y=exp(betaMat%*%t(cbind(rep(1,n),x1,x2))+
t(mvrnorm(n=n,mu=c(0,0,0),Sigma=diag(3))))
# y=y*bin
y=floor(y*bin*matrix(rep(c,each=3),nrow=3))
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
zeroMecha=apply(y,c(1,2),function(x)x>zeroThresh)
y=y*zeroMecha
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
repN=200
sampleSize=5000
n=repN*sampleSize
c=runif(n,1/80,1/20)
zeroThresh=3
betaEffect=1
betaMat=matrix(c(2.5,2.5,2.5,
0,0,betaEffect,
2.5,2.5,2.5),ncol=3)
x1=abs(rnorm(n))
x2=abs(rnorm(n))
bin=matrix(rbinom(n=(3*n),size=1,prob=0.9),nrow=3)
bin[,1:6]
y=exp(betaMat%*%t(cbind(rep(1,n),x1,x2))+
t(mvrnorm(n=n,mu=c(0,0,0),Sigma=diag(3))))
# y=y*bin
y=floor(y*bin*matrix(rep(c,each=3),nrow=3))
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
zeroMecha=apply(y,c(1,2),function(x)x>zeroThresh)
y=y*zeroMecha
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
repN=200
sampleSize=5000
n=repN*sampleSize
c=runif(n,1/80,1/20)
zeroThresh=2
betaEffect=1
betaMat=matrix(c(2.5,2.5,2.5,
0,0,betaEffect,
2.5,2.5,2.5),ncol=3)
x1=abs(rnorm(n))
x2=abs(rnorm(n))
bin=matrix(rbinom(n=(3*n),size=1,prob=0.9),nrow=3)
bin[,1:6]
y=exp(betaMat%*%t(cbind(rep(1,n),x1,x2))+
t(mvrnorm(n=n,mu=c(0,0,0),Sigma=diag(3))))
# y=y*bin
y=floor(y*bin*matrix(rep(c,each=3),nrow=3))
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
zeroMecha=apply(y,c(1,2),function(x)x>zeroThresh)
y=y*zeroMecha
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
y[,1:60]
dim(y)
y1=y
dim(y1)
x1_a=x1
x2_a=x2
beta1=rep(NA,repN)
for(i in 1:repN){
a=(i-1)*sampleSize+1
b=i*sampleSize
# cat("i:",i,"\n")
# cat("a:",a,"\n")
# cat("b:",b,"\n")
y=y1[,a:b]
#print(y[,1:10])
Y12=y[1,]+y[2,]
logY12=log(Y12[Y12>0 & y[3,]>0])
Y3=y[3,(Y12>0 & y[3,]>0)]
logY3=log(Y3)
logY3_12=logY3-logY12
x1=x1_a[a:b]
x1_12=x1[Y12>0 & y[3,]>0]
x2=x2_a[a:b]
x2_12=x2[Y12>0 & y[3,]>0]
# resu.i=summary(lm(logY12~x1_12+x2_12))
resu.i=summary(lm(logY3_12~x1_12+x2_12))
beta1[i]=resu.i$coefficients[2,1]
}
bias=mean(beta1-betaEffect)
cat("estimate:",beta1,"\n")
cbind(TruValue=betaEffect,bias=bias,biasPcen=(100*bias/betaEffect))
zeroMecha_bin=rbinom(n=(3*n),size=1,prob=exp(-eta^2*y))
eta=1
zeroMecha_bin=rbinom(n=(3*n),size=1,prob=exp(-eta^2*y))
e^-3
10^-3
zeroMecha_bin=rbinom(n=(3*n),size=1,prob=exp(-eta^2*y))
zeroMecha_bin
zeroMecha_bin=matrix(rbinom(n=(3*n),size=1,prob=exp(-eta^2*c(y))),nrow=3)
zeroMecha_bin
zeroMecha_bin[,1:10]
zeroMecha_bin[,1:50]
zeroMecha_bin[,1:15]
eta=sqrt(-log(1/2))
eta
y[,1:60]
#
## check additive property of lognormal distribution
#
library(rockchalk) # for mvrnorm()
repN=200
sampleSize=5000
n=repN*sampleSize
c=runif(n,1/80,1/20)
zeroThresh=2
eta=sqrt(-log(1/2))
eta
betaEffect=1
betaMat=matrix(c(2.5,2.5,2.5,
0,0,betaEffect,
2.5,2.5,2.5),ncol=3)
x1=abs(rnorm(n))
x2=abs(rnorm(n))
bin=matrix(rbinom(n=(3*n),size=1,prob=0.9),nrow=3)
bin[,1:6]
y=exp(betaMat%*%t(cbind(rep(1,n),x1,x2))+
t(mvrnorm(n=n,mu=c(0,0,0),Sigma=diag(3))))
# y=y*bin
y=floor(y*bin*matrix(rep(c,each=3),nrow=3))
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
# fixed mechanism
zeroMecha=apply(y,c(1,2),function(x)x>zeroThresh)
# prob mechanism
zeroMecha_bin=matrix(rbinom(n=(3*n),size=1,prob=exp(-eta^2*c(y))),nrow=3)
zeroMecha_bin[,1:15]
y=y*zeroMecha
rowMeans(y==0)
sum(apply(y,c(1,2),function(x)x==0))/(nrow(y)*ncol(y))
y[,1:60]
dim(y)
y1=y
dim(y1)
x1_a=x1
x2_a=x2
beta1=rep(NA,repN)
for(i in 1:repN){
a=(i-1)*sampleSize+1
b=i*sampleSize
# cat("i:",i,"\n")
# cat("a:",a,"\n")
# cat("b:",b,"\n")
y=y1[,a:b]
#print(y[,1:10])
Y12=y[1,]+y[2,]
logY12=log(Y12[Y12>0 & y[3,]>0])
Y3=y[3,(Y12>0 & y[3,]>0)]
logY3=log(Y3)
logY3_12=logY3-logY12
x1=x1_a[a:b]
x1_12=x1[Y12>0 & y[3,]>0]
x2=x2_a[a:b]
x2_12=x2[Y12>0 & y[3,]>0]
# resu.i=summary(lm(logY12~x1_12+x2_12))
resu.i=summary(lm(logY3_12~x1_12+x2_12))
beta1[i]=resu.i$coefficients[2,1]
}
bias=mean(beta1-betaEffect)
cat("estimate:",beta1,"\n")
cbind(TruValue=betaEffect,bias=bias,biasPcen=(100*bias/betaEffect))
library(devtools)
pkg <- 'C:/Users/lzg/Downloads/IFAA/R'
pkg <- 'C:/Users/lzg/Downloads/IFAA'
# create_package(pkg)
setwd(pkg)
# Run this after changing function's R file
devtools::document()
# This will make effect when change DESCRIPTION and R file
devtools::build_manual()
# Build vignettes is time-consuming
# When really need build it, turn it to TRUE
devtools::build(vignettes = T)
library(IFAA)
browseVignettes(IFAA)
browseVignettes("IFAA")
remove.packages("IFAA")
